## 6. База данных (Database)

Хотя основной подход — использование нативных таблиц WordPress (`wp_options`, `wp_postmeta`), стандарт должен покрывать и случай создания кастомных таблиц.

- **Имена таблиц:** `snake_case` с префиксом `{wp_prefix}wd_`. Имя должно быть во множественном числе.
  - **Пример:** `wp_wd_shipments`, `wp_wd_sender_profiles`.
- **Имена колонок:** `snake_case`.
  - **Primary Key:** `id`.
  - **Foreign Keys:** `{table_name_singular}_id` (например, `order_id`).
  - **Булевы значения:** `is_{property}` (например, `is_active`).

### 6.1. Написание запросов (Query Writing)

При написании прямых SQL-запросов необходимо строго следовать стандартам безопасности и форматирования WordPress.

- **Использование `$wpdb`:** Всегда используйте глобальный объект `$wpdb` для взаимодействия с базой данных. Не используйте нативные функции PHP (`mysql_*`, `mysqli_*`).

- **Безопасность (Prepare Statements):** Всегда используйте `$wpdb->prepare()` для всех SQL-запросов, чтобы избежать уязвимостей SQL-инъекций. Это обязательно для любых данных, которые могут быть изменены пользователем, но рекомендуется для всех переменных в запросе.

- **Форматирование SQL:** Для сложных запросов придерживайтесь следующего форматирования для улучшения читаемости:
  - **Ключевые слова:** Пишите SQL-ключевые слова в верхнем регистре (`SELECT`, `FROM`, `WHERE`, `JOIN`, `ON`, `GROUP BY`, `ORDER BY`).
  - **Структура:** Каждый основной блок запроса должен начинаться с новой строки.
  - **Имена:** Имена таблиц и колонок должны быть заключены в обратные кавычки (`` ` ``).
  - **Пример:**
    ```php
    $status = 'publish';
    $limit  = 10;

    $results = $wpdb->get_results( $wpdb->prepare(
        "SELECT `p`.`ID`, `p`.`post_title`
        FROM `{$wpdb->posts}` AS `p`
        WHERE `p`.`post_type` = 'post' AND `p`.`post_status` = %s
        ORDER BY `p`.`post_date` DESC
        LIMIT %d",
        $status,
        $limit
    ) );
    ```